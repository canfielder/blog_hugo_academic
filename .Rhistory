blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
if (!require(pacman)) {install.packages('pacman')}
p_load(grid, leaflet, stringr, tidyverse, tigris, widgetframe)
options(tigris_use_cache = TRUE)
# State Shapefiles
sf_state <- readRDS(file = "data/us_state_map.RDS")
# County Shapefiles
sf_county <- readRDS(file = "data/us_county_map.RDS")
df <- read.csv("data/catalog_personal_travel.csv",
stringsAsFactors = FALSE)
# Functin For Adding Leading Zeros
pad_chr <- function(x, na.rm=FALSE)  str_pad(string = x,
width = max(nchar(x)),
side = 'left', pad = 0)
df <- df %>%
# Convert state_code and county_code from int to chr
mutate_at(vars(contains('code')), as.character) %>%
mutate_at(vars(contains('code')), pad_chr)
df_state <- df %>%
group_by(state_code) %>%
summarise(visited = sum(visited)) %>%
mutate(visited = if_else(visited >= 1, 1, 0))
sf_state_visit <- sf_state %>%
left_join(df_state, by = c("state_fips" = "state_code"))
# Style Settings
col_pal <- c("#F4F6F6", "#1F618D")
col_edge <- "gray90"
alpha = 0.75
size = 0.005
# Theme Settings
theme_choropleth <- function(){
theme_void() +
theme(
legend.position = "none"
)
}
p_state <- ggplot()
p_state_1 <- p_state + geom_polygon(
data = sf_state_visit,
mapping = aes(x = long, y = lat, group = group, fill = factor(visited)),
color = col_edge,
alpha = alpha,
size = size) +
coord_equal() +
scale_fill_manual(values = col_pal) +
theme_choropleth()
p_state_1
sf_county_visit <- sf_county %>%
left_join(df, by = c("state_fips" = "state_code",
"county_fips" = "county_code"))
plot_county <- function(df_state, df_county){
# County Choropleth
p_county <- ggplot()
p_county_1 <- p_county + geom_polygon(
data = df_county,
mapping = aes(x = long, y = lat, group = group, fill = factor(visited)),
color = col_edge,
alpha = alpha,
size = size) +
coord_equal() +
scale_fill_manual(values = col_pal) +
theme_choropleth()
# State Overlay
P_state_overlay <-  geom_polygon(
data = df_state,
mapping = aes(x = long, y = lat, group = group),
color = col_edge,
alpha = 0,
size = 1)
# Combine
p_county_1 + P_state_overlay
}
plot_county(sf_state_visit, sf_county_visit)
# State FIPS codes
new_england_fips = c("09", "23", "25", "33", "44", "50")
sf_county_visit_ne <- sf_county_visit %>%
filter(state_fips %in% new_england_fips)
sf_state_visit_ne <- sf_state_visit %>%
filter(state_fips %in% new_england_fips)
p_ne <- plot_county(sf_state_visit_ne, sf_county_visit_ne)
print(p_ne, vp=viewport(angle=-17.5))
# State FIPs codes
car_fips = c("37", "45")
sf_county_visit_nc <- sf_county_visit %>%
filter(state_fips %in% car_fips)
sf_state_visit_nc <- sf_state_visit %>%
filter(state_fips %in% car_fips)
p_car <- plot_county(sf_state_visit_nc, sf_county_visit_nc)
print(p_car, vp=viewport(angle=-13.5))
#State
spdf_state <- states(cb = TRUE)
#County
spdf_county <- counties(cb = TRUE)
df <- df %>%
mutate(FIPS = str_c(state_code, county_code))
spdf_county_visited <- geo_join(spatial_data = spdf_county,
data_frame = df,
by_sp = "GEOID",
by_df = "FIPS")
col_pal_leaflet <- colorNumeric(palette = "viridis",
domain = spdf_county_visited$visited)
lf <- leaflet(options = leafletOptions(minZoom = 3)) %>%
addTiles() %>%
addPolygons(data = spdf_state,
color = "#2E4053",
weight = 1,
opacity = 1,
dashArray = 1.5,
fillColor = "white",
fillOpacity = 0
) %>%
addPolygons(data = spdf_county_visited,
highlight = highlightOptions(color = "white"),
fillColor = ~col_pal_leaflet(spdf_county_visited$visited),
weight = 0.5,
opacity = 1,
color = "white",
dashArray = 2.5,
fillOpacity = 0.25,
label =  ~paste(NAME)
) %>%
setView(lng = -96,
lat = 37.8,
zoom = 4) %>%
setMaxBounds(lng1 = -180,
lng2 = -60,
lat1 = 73,
lat2 = 15)
htmlwidgets::saveWidget(widget = lf, file = "figure.html", selfcontained = TRUE)
ggsave(filename = "featured_50.png", p_state_1, scale = 0.5)
ggsave(filename = "featured_50.png", p_state_1, scale = 0.25)
ggsave(filename = "featured_25.png", p_state_1, scale = 0.25)
ggsave(filename = "featured_3-5.png", p_state_1, width = 3.5, height = 3.5)
blogdown:::serve_site()
